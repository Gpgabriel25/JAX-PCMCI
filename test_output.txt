============================= test session starts ==============================
platform linux -- Python 3.13.7, pytest-9.0.2, pluggy-1.6.0 -- /home/gpgabriel25/Projects/JAX-PCMCI/.venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/gpgabriel25/Projects/JAX-PCMCI
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: cov-7.0.0
collecting ... collected 15 items

tests/test_pcmci.py::TestDataHandler::test_basic_creation PASSED         [  6%]
tests/test_pcmci.py::TestDataHandler::test_normalization PASSED          [ 13%]
tests/test_pcmci.py::TestDataHandler::test_get_lagged_data PASSED        [ 20%]
tests/test_pcmci.py::TestDataHandler::test_get_variable_pair_data PASSED [ 26%]
tests/test_pcmci.py::TestPCMCI::test_basic_run FAILED                    [ 33%]
tests/test_pcmci.py::TestPCMCI::test_discovers_true_links FAILED         [ 40%]
tests/test_pcmci.py::TestPCMCI::test_pc_phase_reduces_parents FAILED     [ 46%]
tests/test_pcmci.py::TestPCMCI::test_different_alpha_levels FAILED       [ 53%]
tests/test_pcmci.py::TestPCMCI::test_batch_mci_respects_condition_limits PASSED [ 60%]
tests/test_pcmci.py::TestPCMCIPlus::test_basic_run PASSED                [ 66%]
tests/test_pcmci.py::TestPCMCIPlus::test_includes_contemporaneous PASSED [ 73%]
tests/test_pcmci.py::TestPCMCIResults::test_summary PASSED               [ 80%]
tests/test_pcmci.py::TestPCMCIResults::test_fdr_correction PASSED        [ 86%]
tests/test_pcmci.py::TestPCMCIResults::test_get_parents PASSED           [ 93%]
tests/test_pcmci.py::TestPCMCIResults::test_to_dict PASSED               [100%]

=================================== FAILURES ===================================
___________________________ TestPCMCI.test_basic_run ___________________________
tests/test_pcmci.py:112: in test_basic_run
    results = pcmci.run(tau_max=2, pc_alpha=0.1)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
jax_pcmci/algorithms/pcmci.py:375: in run
    self._parents = self.run_pc_stable(
jax_pcmci/algorithms/pcmci.py:651: in run_pc_stable
    X_b, Y_b, Z_b = self.datahandler.get_variable_pair_batch(
jax_pcmci/data.py:660: in get_variable_pair_batch
    X = self._batch_slice_1d(self.values, start_x, i_arr, effective_T)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
jax_pcmci/data.py:617: in _batch_slice_1d
    return jax.vmap(slice_one)(start_idxs, var_idxs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
jax_pcmci/data.py:615: in slice_one
    return lax.dynamic_slice(values, (start_idx, var_idx), (length, 1)).squeeze(1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: lax.concatenate requires arguments to have the same dtypes, got int64, int32. (Tip: jnp.concatenate is a similar function that does automatic type promotion on inputs).
E   --------------------
E   For simplicity, JAX has removed its internal frames from the traceback of the following exception. Set JAX_TRACEBACK_FILTERING=off to include these.
_____________________ TestPCMCI.test_discovers_true_links ______________________
tests/test_pcmci.py:124: in test_discovers_true_links
    results = pcmci.run(tau_max=2, pc_alpha=0.05, alpha_level=0.05)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
jax_pcmci/algorithms/pcmci.py:375: in run
    self._parents = self.run_pc_stable(
jax_pcmci/algorithms/pcmci.py:651: in run_pc_stable
    X_b, Y_b, Z_b = self.datahandler.get_variable_pair_batch(
jax_pcmci/data.py:660: in get_variable_pair_batch
    X = self._batch_slice_1d(self.values, start_x, i_arr, effective_T)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
jax_pcmci/data.py:617: in _batch_slice_1d
    return jax.vmap(slice_one)(start_idxs, var_idxs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
jax_pcmci/data.py:615: in slice_one
    return lax.dynamic_slice(values, (start_idx, var_idx), (length, 1)).squeeze(1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: lax.concatenate requires arguments to have the same dtypes, got int64, int32. (Tip: jnp.concatenate is a similar function that does automatic type promotion on inputs).
E   --------------------
E   For simplicity, JAX has removed its internal frames from the traceback of the following exception. Set JAX_TRACEBACK_FILTERING=off to include these.
___________________ TestPCMCI.test_pc_phase_reduces_parents ____________________
tests/test_pcmci.py:141: in test_pc_phase_reduces_parents
    parents = pcmci.run_pc_stable(tau_max=2, pc_alpha=0.05)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
jax_pcmci/algorithms/pcmci.py:651: in run_pc_stable
    X_b, Y_b, Z_b = self.datahandler.get_variable_pair_batch(
jax_pcmci/data.py:660: in get_variable_pair_batch
    X = self._batch_slice_1d(self.values, start_x, i_arr, effective_T)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
jax_pcmci/data.py:617: in _batch_slice_1d
    return jax.vmap(slice_one)(start_idxs, var_idxs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
jax_pcmci/data.py:615: in slice_one
    return lax.dynamic_slice(values, (start_idx, var_idx), (length, 1)).squeeze(1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: lax.concatenate requires arguments to have the same dtypes, got int64, int32. (Tip: jnp.concatenate is a similar function that does automatic type promotion on inputs).
E   --------------------
E   For simplicity, JAX has removed its internal frames from the traceback of the following exception. Set JAX_TRACEBACK_FILTERING=off to include these.
____________________ TestPCMCI.test_different_alpha_levels _____________________
tests/test_pcmci.py:155: in test_different_alpha_levels
    results_loose = pcmci.run(tau_max=2, alpha_level=0.1)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
jax_pcmci/algorithms/pcmci.py:375: in run
    self._parents = self.run_pc_stable(
jax_pcmci/algorithms/pcmci.py:651: in run_pc_stable
    X_b, Y_b, Z_b = self.datahandler.get_variable_pair_batch(
jax_pcmci/data.py:660: in get_variable_pair_batch
    X = self._batch_slice_1d(self.values, start_x, i_arr, effective_T)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
jax_pcmci/data.py:617: in _batch_slice_1d
    return jax.vmap(slice_one)(start_idxs, var_idxs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
jax_pcmci/data.py:615: in slice_one
    return lax.dynamic_slice(values, (start_idx, var_idx), (length, 1)).squeeze(1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: lax.concatenate requires arguments to have the same dtypes, got int64, int32. (Tip: jnp.concatenate is a similar function that does automatic type promotion on inputs).
E   --------------------
E   For simplicity, JAX has removed its internal frames from the traceback of the following exception. Set JAX_TRACEBACK_FILTERING=off to include these.
=========================== short test summary info ============================
FAILED tests/test_pcmci.py::TestPCMCI::test_basic_run - TypeError: lax.concat...
FAILED tests/test_pcmci.py::TestPCMCI::test_discovers_true_links - TypeError:...
FAILED tests/test_pcmci.py::TestPCMCI::test_pc_phase_reduces_parents - TypeEr...
FAILED tests/test_pcmci.py::TestPCMCI::test_different_alpha_levels - TypeErro...
======================== 4 failed, 11 passed in 21.37s =========================
